<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:0; }
  .container { width: 90%; max-width:1200px; margin: auto; padding:20px; }
  h1 { text-align:center; margin-bottom:30px; }
  .section { background:#fff; padding:20px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  .section h2 { margin-top:0; }
  .input-group { margin-bottom:15px; }
  .input-group label { display:block; margin-bottom:5px; font-weight:bold; }
  .input-group input, .input-group textarea, .input-group select { width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; }
  .btn { padding:10px 20px; background:#007BFF; color:#fff; border:none; border-radius:4px; cursor:pointer; margin-top:10px; }
  .btn:hover { background:#0056b3; }
  .cards-container { display:flex; flex-wrap:wrap; gap:20px; }
  .card-item { border:1px solid #ccc; padding:10px; border-radius:4px; width:200px; position:relative; }
  .card-item img { max-width:100%; border-radius:4px; margin-bottom:5px; }
  .remove-card { position:absolute; top:5px; right:5px; background:red; color:#fff; border:none; border-radius:50%; cursor:pointer; width:24px; height:24px; text-align:center; }
</style>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
</head>
<body>
<div class="container">
  <h1>Portfolio Admin Dashboard</h1>

  <!-- Authentication -->
  <div class="section" id="auth-section">
    <h2>Login</h2>
    <div class="input-group">
      <label>Email</label>
      <input type="email" id="admin-email" />
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="admin-password" />
    </div>
    <button class="btn" onclick="login()">Login</button>
    <p id="auth-msg" style="color:red;"></p>
  </div>

  <!-- Admin Sections (hidden until login) -->
  <div id="admin-content" style="display:none;">

    <!-- Site Metadata -->
    <div class="section">
      <h2>Site Metadata</h2>
      <div class="input-group">
        <label>Title</label>
        <input type="text" id="site-title"/>
      </div>
      <div class="input-group">
        <label>Favicon URL</label>
        <input type="text" id="favicon-url"/>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="section">
      <h2>Hero Section</h2>
      <div class="input-group">
        <label>Heading</label>
        <input type="text" id="hero-heading"/>
      </div>
      <div class="input-group">
        <label>Subheading</label>
        <textarea id="hero-subheading"></textarea>
      </div>
      <div class="input-group">
        <label>Hero Image</label>
        <input type="file" id="hero-image"/>
      </div>
    </div>

    <!-- About Me Section -->
    <div class="section">
      <h2>About Me</h2>
      <div class="input-group">
        <label>Paragraph</label>
        <textarea id="about-text"></textarea>
      </div>
    </div>

    <!-- Cards Section -->
    <div class="section">
      <h2>Cards (Projects / Experience / Certifications)</h2>
      <div class="cards-container" id="cards-container"></div>
      <button class="btn" onclick="addCard()">Add Card</button>
    </div>

    <!-- Skills Section -->
    <div class="section">
      <h2>Skills</h2>
      <div class="input-group">
        <label>Skills (comma separated)</label>
        <input type="text" id="skills-text"/>
      </div>
    </div>

    <!-- Resume Section -->
    <div class="section">
      <h2>Resume</h2>
      <div class="input-group">
        <label>Resume URL</label>
        <input type="text" id="resume-url"/>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="section">
      <h2>Footer</h2>
      <div class="input-group">
        <label>Footer Text</label>
        <input type="text" id="footer-text"/>
      </div>
      <div class="input-group">
        <label>Social Links (JSON)</label>
        <textarea id="footer-social"></textarea>
      </div>
    </div>

    <button class="btn" onclick="saveAll()">Save All Changes</button>
    <p id="save-msg" style="color:green;"></p>
  </div>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBl7UeClHdUhEQC4eJXH8cTFsy31XPFrII",
    authDomain: "portfolio-fc649.firebaseapp.com",
    databaseURL: "https://portfolio-fc649-default-rtdb.firebaseio.com",
    projectId: "portfolio-fc649",
    storageBucket: "portfolio-fc649.firebasestorage.app",
    messagingSenderId: "134392119777",
    appId: "1:134392119777:web:8b1fccb70bfe26886052a0",
    measurementId: "G-FYDPK3854Q"  
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  // Login
  function login(){
    const email = document.getElementById('admin-email').value;
    const pass = document.getElementById('admin-password').value;
    auth.signInWithEmailAndPassword(email, pass)
    .then(() => {
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('admin-content').style.display = 'block';
      loadData();
    })
    .catch(err => document.getElementById('auth-msg').innerText = err.message);
  }

  // Load data from Firebase
  function loadData(){
    db.ref('/portfolio').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      document.getElementById('site-title').value = data.title || '';
      document.getElementById('favicon-url').value = data.favicon || '';
      document.getElementById('hero-heading').value = data.hero?.heading || '';
      document.getElementById('hero-subheading').value = data.hero?.subheading || '';
      document.getElementById('about-text').value = data.about || '';
      document.getElementById('skills-text').value = (data.skills || []).join(',');
      document.getElementById('resume-url').value = data.resume || '';
      document.getElementById('footer-text').value = data.footer?.text || '';
      document.getElementById('footer-social').value = JSON.stringify(data.footer?.social || []);
      
      // Load cards
      const cardsContainer = document.getElementById('cards-container');
      cardsContainer.innerHTML = '';
      (data.cards || []).forEach((card, index)=>{
        createCardElement(card, index);
      });
    });
  }

  // Create card element
  function createCardElement(card = {title:'',desc:'',img:''}, index){
    const container = document.getElementById('cards-container');
    const div = document.createElement('div');
    div.className = 'card-item';
    div.dataset.index = index;

    const img = document.createElement('img');
    img.src = card.img || '';
    div.appendChild(img);

    const title = document.createElement('input');
    title.value = card.title;
    title.placeholder = 'Card Title';
    div.appendChild(title);

    const desc = document.createElement('textarea');
    desc.value = card.desc;
    desc.placeholder = 'Card Description';
    div.appendChild(desc);

    const file = document.createElement('input');
    file.type='file';
    file.onchange = e => uploadCardImage(e, div.dataset.index);
    div.appendChild(file);

    const removeBtn = document.createElement('button');
    removeBtn.className='remove-card';
    removeBtn.innerText='Ã—';
    removeBtn.onclick = () => { container.removeChild(div); };
    div.appendChild(removeBtn);

    container.appendChild(div);
  }

  function addCard(){ createCardElement(); }

  function uploadCardImage(e, index){
    const file = e.target.files[0];
    if(!file) return;
    const storageRef = storage.ref('cards/'+file.name);
    storageRef.put(file).then(()=> storageRef.getDownloadURL().then(url=>{
      document.querySelectorAll('.card-item')[index].querySelector('img').src = url;
    }));
  }

  // Save all
  function saveAll(){
    const cards = [];
    document.querySelectorAll('.card-item').forEach(div=>{
      cards.push({
        title: div.querySelector('input').value,
        desc: div.querySelector('textarea').value,
        img: div.querySelector('img').src
      });
    });

    const data = {
      title: document.getElementById('site-title').value,
      favicon: document.getElementById('favicon-url').value,
      hero: {
        heading: document.getElementById('hero-heading').value,
        subheading: document.getElementById('hero-subheading').value
      },
      about: document.getElementById('about-text').value,
      cards: cards,
      skills: document.getElementById('skills-text').value.split(',').map(s=>s.trim()),
      resume: document.getElementById('resume-url').value,
      footer: {
        text: document.getElementById('footer-text').value,
        social: JSON.parse(document.getElementById('footer-social').value || '[]')
      }
    };
    db.ref('/portfolio').set(data).then(()=>{
      document.getElementById('save-msg').innerText = 'Saved Successfully!';
      setTimeout(()=> document.getElementById('save-msg').innerText='', 3000);
    });
  }
</script>
</body>
</html>
